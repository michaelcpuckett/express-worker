<script>
  // Registers the service worker, which will run the tests upon activation.
  window.navigator.serviceWorker
    .register('/base/tests/sw.js', {
      scope: '/',
      updateViaCache: 'none',
    })
    .then(async (registration) => {
      await new Promise((resolve, reject) => {
        const serviceWorker =
          registration.waiting ||
          registration.active ||
          registration.installing;

        if (!serviceWorker) {
          console.log('Test service worker failed to install');
          reject('No service worker registration found!');
          return;
        }

        if (serviceWorker.state === 'activated') {
          resolve();
        }

        serviceWorker.addEventListener('statechange', (event) => {
          if (event.target.state === 'activated') {
            resolve();
          }
        });
      });
    });
</script>
